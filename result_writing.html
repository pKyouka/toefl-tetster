<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOEFL Writing Test Results</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .score {
        font-size: 48px;
        color: #27ae60;
      }
      tr.incorrect {
        background-color: #ffe6e6;
        color: #8b0000;
      }
      tr.incorrect td {
        background-color: #ffe6e6;
      }
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .response-box {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .word-count {
        font-size: 0.9em;
        color: #6c757d;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container my-5">
      <div class="card shadow">
        <div class="card-body p-4">
          <h1 class="text-center text-primary mb-4">
            TOEFL Writing Test Results
          </h1>

          <div class="text-center mb-5">
            <div class="score" id="score"></div>
            <p class="text-muted">Your writing responses have been saved</p>
          </div>

          <div class="mb-5">
            <h2 class="mb-3">Performance Summary</h2>
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Task Type</th>
                    <th>Status</th>
                    <th>Word Count</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Picture Description</td>
                    <td id="picture-status">Completed</td>
                    <td id="picture-wordcount">-</td>
                  </tr>
                  <tr>
                    <td>Email Response</td>
                    <td id="email-status">Completed</td>
                    <td id="email-wordcount">-</td>
                  </tr>
                  <tr>
                    <td>Essay Writing</td>
                    <td id="essay-status">Completed</td>
                    <td id="essay-wordcount">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="mb-4">
            <h2 class="mb-3">Writing Responses</h2>
            <div id="writing-responses"></div>
          </div>

          <div class="d-flex justify-content-center gap-3 mt-5">
            <button
              class="btn btn-primary"
              onclick="window.location.href='index.html'"
            >
              Back to Home
            </button>
            <button class="btn btn-secondary" onclick="window.print()">
              Print Results
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const writingQuestions = [
        {
          id: 1,
          type: "picture",
          question:
            "1. Write a sentence based on the picture below using the two words provided.",
          words: "friend/camp",
          minWords: 1,
        },
        {
          id: 2,
          type: "picture",
          question:
            "2. Write a sentence based on the picture below using the two words provided.",
          words: "cashier/pay",
          minWords: 1,
        },
        {
          id: 3,
          type: "picture",
          question:
            "3. Write a sentence based on the picture below using the two words provided.",
          words: "grandfather/garden",
          minWords: 1,
        },
        {
          id: 4,
          type: "picture",
          question:
            "4. Write a sentence based on the picture below using the two words provided.",
          words: "clean/before",
          minWords: 1,
        },
        {
          id: 5,
          type: "picture",
          question:
            "5. Write a sentence based on the picture below using the two words provided.",
          words: "circus/perform",
          minWords: 1,
        },
        {
          id: 6,
          type: "email",
          question:
            "6. Respond to the email below. Describe ONE issue you have encountered with the HP 27inch All-in-One Desktop PC and make ONE request for assistance.",
          email: {
            from: "IDN Computer Jakarta Pusat",
            to: "Valued Customer",
            subject: "Thank you for choosing IDN Computer Jakarta Pusat",
            date: "March 5, 9:00 a.m.",
            body: "We are thrilled to have you as a valued customer of IDN Computer Jakarta Pusat! Thank you for your recent purchase of the HP 27inch All-in-One Desktop PC. We hope you are enjoying the cutting-edge features and performance of our product. Should you encounter any difficulties or have any questions, please feel free to reach out to us at idncomp.jakpusservice@gmail.com.",
          },
          minWords: 50,
        },
        {
          id: 7,
          type: "email",
          question:
            "7. Respond to the email below. Describe ONE problem that makes you unable to do the request. In your email, offer ONE solution for the sender.",
          email: {
            from: "Danis Peterson",
            to: "Rosaline Rice",
            subject: "Request for Updated Sales Report",
            date: "January 15, 10:00 a.m.",
            body: "Could you please send me the updated sales report for the third quarter by tomorrow afternoon? I need it for an important presentation. Let me know if you need any additional information.",
          },
          minWords: 50,
        },
        {
          id: 8,
          type: "essay",
          question:
            "8. Some individuals claim that technology leads to increased isolation and reduced social interaction, whereas others believe that it improves communication and fosters connections. What is your perspective on this matter? Please clarify your opinion and provide supporting reasons.",
          minWords: 300,
        },
      ];

      const savedResponses =
        JSON.parse(localStorage.getItem("writingResponses")) || [];

      let pictureCount = 0;
      let pictureWords = 0;
      let emailCount = 0;
      let emailWords = 0;
      let essayCount = 0;
      let essayWords = 0;
      const responsesContainer = document.getElementById("writing-responses");
      if (savedResponses.length === 0) {
        responsesContainer.innerHTML = `
      <div class="alert alert-warning">
        No writing responses found. Please complete the writing test first.
      </div>
    `;
      } else {
        writingQuestions.forEach((question, index) => {
          const response = savedResponses[index]?.response || "";
          const wordCount =
            response.trim() === "" ? 0 : response.trim().split(/\s+/).length;
          if (question.type === "picture") {
            pictureCount++;
            pictureWords += wordCount;
          } else if (question.type === "email") {
            emailCount++;
            emailWords += wordCount;
          } else if (question.type === "essay") {
            essayCount++;
            essayWords += wordCount;
          }
          const responseElement = document.createElement("div");
          responseElement.className = "mb-4";

          let content = `
        <h4>${question.question}</h4>
        <div class="response-box">
          <p><strong>Your Response:</strong></p>
          <p>${response || "<em>No response provided</em>"}</p>
          <p class="word-count">Word count: ${wordCount}${
            question.minWords ? ` (Minimum required: ${question.minWords})` : ""
          }</p>
        </div>
      `;

          if (question.type === "email") {
            content = `
          <h4>${question.question}</h4>
          <div class="email-preview mb-3">
            <div class="email-header">
              <p><strong>From:</strong> ${question.email.from}</p>
              <p><strong>To:</strong> ${question.email.to}</p>
              <p><strong>Subject:</strong> ${question.email.subject}</p>
              <p><strong>Sent:</strong> ${question.email.date}</p>
            </div>
            <p>${question.email.body}</p>
          </div>
          <div class="response-box">
            <p><strong>Your Response:</strong></p>
            <p>${response || "<em>No response provided</em>"}</p>
            <p class="word-count">Word count: ${wordCount}${
              question.minWords
                ? ` (Minimum required: ${question.minWords})`
                : ""
            }</p>
          </div>
        `;
          }

          responseElement.innerHTML = content;
          responsesContainer.appendChild(responseElement);
        });

        // Update performance summary
        document.getElementById("picture-status").textContent =
          pictureCount === 5
            ? "Completed (5/5)"
            : `Partial (${pictureCount}/5)`;
        document.getElementById("picture-wordcount").textContent =
          pictureCount > 0
            ? Math.round(pictureWords / pictureCount) + " avg"
            : "-";

        document.getElementById("email-status").textContent =
          emailCount === 2 ? "Completed (2/2)" : `Partial (${emailCount}/2)`;
        document.getElementById("email-wordcount").textContent =
          emailCount > 0 ? Math.round(emailWords / emailCount) + " avg" : "-";

        document.getElementById("essay-status").textContent =
          essayCount === 1 ? "Completed" : "Not completed";
        document.getElementById("essay-wordcount").textContent =
          essayCount > 0 ? essayWords : "-";

        const totalQuestions = writingQuestions.length;
        const completedQuestions = savedResponses.filter(
          (r) => r?.response?.trim().length > 0
        ).length;
        document.getElementById(
          "score"
        ).textContent = `${completedQuestions}/${totalQuestions}`;
      }
      // Blokir klik kanan
      document.addEventListener("contextmenu", function (e) {
        e.preventDefault();
        return false;
      });

      // Blokir inspect element
      document.addEventListener("keydown", function (e) {
        if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) {
          e.preventDefault();
          return false;
        }
      });
    </script>
  </body>
</html>
