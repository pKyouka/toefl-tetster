<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOEFL Reading Practice</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Custom styles that can't be handled by Bootstrap */
      .question-number {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .question-number.answered {
        background-color: #e0e0e0;
      }

      .question-number.current {
        border: 2px solid #4caf50;
        font-weight: bold;
      }

      .reading-content {
        max-height: calc(100vh - 160px);
        overflow-y: auto;
      }

      .passage {
        text-align: justify;
      }

      .question-container {
        display: none;
      }

      .question-container.active {
        display: block;
      }

      .options label {
        cursor: pointer;
      }

      .modal {
        display: none;
      }

      /* Disable right-click */
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
    </style>
  </head>
  <body class="d-flex flex-column min-vh-100 p-4">
    <header class="text-center mb-4">
      <h1>TOEFL Reading Practice Test</h1>
      <p>Read the passage and answer the questions below.</p>
    </header>

    <div class="container-fluid flex-grow-1">
      <div class="row">
        <!-- Left column - question navigation -->
        <div class="col-md-2">
          <div class="card mb-3">
            <div class="card-body">
              <h3 class="card-title text-center">Questions</h3>
              <div class="d-flex flex-wrap gap-2" id="questionNumbers"></div>
            </div>
          </div>

          <div class="card mb-3">
            <div class="card-body text-center fw-bold">
              <div id="timer">Time Remaining: --:--</div>
            </div>
          </div>

          <div class="card">
            <div class="card-body text-center">
              <button
                type="submit"
                class="btn btn-primary w-100"
                id="submitBtn"
              >
                Submit Answers
              </button>
            </div>
          </div>
        </div>

        <!-- Right column - questions -->
        <div class="col-md-10">
          <div class="card">
            <div class="card-body reading-content">
              <div class="mb-4">
                <h2>Section II: Reading</h2>
                <p>
                  In the reading test, you will read a variety of texts and
                  answer several different types of reading comprehension
                  questions. The entire reading test will last 75 minutes. There
                  are three parts and directions are given for each part. You
                  are encouraged to answer as many questions as possible within
                  the time allowed. You must mark your answers on the separate
                  answer sheet. Do not write your answers in your test book.
                </p>
              </div>

              <div class="mb-4">
                <h3>Part 5: Incomplete Sentences</h3>
                <p>
                  Directions: A word or phrase is missing in each of the
                  following sentences. Four answer choices are given below each
                  sentence. Then, mark the letter A, B, C or D on your answer
                  sheet.
                </p>
              </div>

              <form id="reading-quiz">
                <!-- Questions will be created in script -->

                <div class="d-flex justify-content-between mt-4">
                  <button
                    type="button"
                    class="btn btn-light"
                    id="prevBtn"
                    disabled
                  >
                    Previous
                  </button>
                  <button type="button" class="btn btn-success" id="nextBtn">
                    Next
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary"
                    id="submitPageBtn"
                    style="display: none"
                  >
                    Submit Answers
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body text-center">
            <h3 class="modal-title">Are you sure it's finished?</h3>
            <p>You won't be able to change your answers after submitting.</p>
            <div class="d-flex justify-content-center gap-3 mt-3">
              <button class="btn btn-success" id="confirmYes">
                Yes, Submit
              </button>
              <button class="btn btn-danger" id="confirmNo">
                No, Continue
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="text-center text-muted mt-4">
      <p>© 2023 TOEFL Tester | Practice Reading Skills</p>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Data pertanyaan
      const questionsPerPage = 5;
      const questions = [
        {
          question:
            "1. The company has experienced … growth over the past year.",
          options: [
            "a) significant",
            "b) signification",
            "c) significance",
            "d) significantly",
          ],
          correctAnswer: "a",
        },
        {
          question:
            "2. The marketing department is planning a … campaign to promote the new product.",
          options: [
            "a) advertising",
            "b) advertiser",
            "c) advertised",
            "d) advertise",
          ],
          correctAnswer: "a",
        },
        {
          question:
            "3. The passage mentions all of the following as regions where early agriculture developed EXCEPT:",
          options: [
            "a) The Fertile Crescent",
            "b) Australia",
            "c) China",
            "d) Mesoamerica",
          ],
          correctAnswer: "b",
        },
        {
          question:
            "4. According to the passage, which crop was commonly domesticated in the Fertile Crescent?",
          options: ["a) Rice", "b) Maize", "c) Wheat", "d) Potatoes"],
          correctAnswer: "c",
        },
        {
          question:
            "5. The passage suggests that the development of agriculture led to:",
          options: [
            "a) A decrease in human population",
            "b) The development of social hierarchies",
            "c) A more nomadic lifestyle",
            "d) The end of human civilization",
          ],
          correctAnswer: "b",
        },
        {
          question:
            "6. Which of the following is NOT mentioned as a benefit of agriculture in the passage?",
          options: [
            "a) Increased food supply",
            "b) Development of cities",
            "c) Improved technology",
            "d) More leisure time",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "7. What does the passage imply about hunter-gatherer societies?",
          options: [
            "a) They were more advanced than agricultural societies",
            "b) They had larger populations",
            "c) They moved from place to place",
            "d) They built permanent homes",
          ],
          correctAnswer: "c",
        },
        {
          question:
            "8. Which of the following words can best replace the word 'domesticated' in paragraph 2?",
          options: [
            "a) Planted",
            "b) Cultivated",
            "c) Harvested",
            "d) Gathered",
          ],
          correctAnswer: "b",
        },
        {
          question: "9. What is the main idea of the passage?",
          options: [
            "a) The history of modern humans",
            "b) The origins of agriculture",
            "c) The development of cities",
            "d) The impact of climate change",
          ],
          correctAnswer: "b",
        },
        {
          question:
            "10. According to the passage, what was one effect of agriculture on human society?",
          options: [
            "a) People began to live shorter lives",
            "b) People started traveling more frequently",
            "c) People became more dependent on nature",
            "d) People formed governments",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "11. According to the passage, what was one effect of agriculture on human society?",
          options: [
            "a) People began to live shorter lives",
            "b) People started traveling more frequently",
            "c) People became more dependent on nature",
            "d) People formed governments",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "12. According to the passage, what was one effect of agriculture on human society?",
          options: [
            "a) People began to live shorter lives",
            "b) People started traveling more frequently",
            "c) People became more dependent on nature",
            "d) People formed governments",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "13. According to the passage, what was one effect of agriculture on human society?",
          options: [
            "a) People began to live shorter lives",
            "b) People started traveling more frequently",
            "c) People became more dependent on nature",
            "d) People formed governments",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "14. Which of the following is NOT mentioned as a benefit of agriculture in the passage?",
          options: [
            "a) Increased food supply",
            "b) Development of cities",
            "c) Improved technology",
            "d) More leisure time",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "15. What does the passage imply about hunter-gatherer societies?",
          options: [
            "a) They were more advanced than agricultural societies",
            "b) They had larger populations",
            "c) They moved from place to place",
            "d) They built permanent homes",
          ],
          correctAnswer: "c",
        },
        {
          question:
            "16. Which of the following words can best replace the word 'domesticated' in paragraph 2?",
          options: [
            "a) Planted",
            "b) Cultivated",
            "c) Harvested",
            "d) Gathered",
          ],
          correctAnswer: "b",
        },
        {
          question: "17. What is the main idea of the passage?",
          options: [
            "a) The history of modern humans",
            "b) The origins of agriculture",
            "c) The development of cities",
            "d) The impact of climate change",
          ],
          correctAnswer: "b",
        },
        {
          question: "18. What is the main idea of the passage?",
          options: [
            "a) The history of modern humans",
            "b) The origins of agriculture",
            "c) The development of cities",
            "d) The impact of climate change",
          ],
          correctAnswer: "c",
        },
        {
          question: "19. The company will ... a new product line next month.",
          options: [
            "a) introduce",
            "b) introduced",
            "c) introduction",
            "d) introducing",
          ],
          correctAnswer: "a",
        },
        {
          question: "20. The meeting was postponed ... the CEO's absence.",
          options: ["a) because", "b) due to", "c) although", "d) unless"],
          correctAnswer: "b",
        },
        {
          question:
            "21. We can take the bus ... the subway to get to the office.",
          options: ["a) or", "b) but", "c) because", "d) so"],
          correctAnswer: "a",
        },
        {
          question:
            "22. Mr. John didn't attend the meeting ... he was feeling unwell.",
          options: ["a) since", "b) but", "c) so", "d) and"],
          correctAnswer: "a",
        },
        {
          question:
            "23. Mrs. Kim can't go to the party ... she has an important appointment.",
          options: ["a) while", "b) because", "c) unless", "d) so"],
          correctAnswer: "b",
        },
        {
          question:
            "24. The contract must be ... by both parties before the end of the month.",
          options: ["a) sign", "b) signing", "c) signs", "d) signed"],
          correctAnswer: "d",
        },
        {
          question: "25. The marketing team ... a new campaign every quarter.",
          options: [
            "a) develops",
            "b) developed",
            "c) developing",
            "d) will develop",
          ],
          correctAnswer: "a",
        },
        {
          question: "26. The project will be ... before the deadline.",
          options: [
            "a) completes",
            "b) completed",
            "c) completing",
            "d) complete",
          ],
          correctAnswer: "b",
        },
        {
          question:
            "27. The new product was launched last month, ... it is already becoming popular among customers.",
          options: ["a) so", "b) but", "c) for", "d) because"],
          correctAnswer: "a",
        },
        {
          question:
            "28. The marketing team worked ... to meet the deadline, ensuring the campaign was launched on time.",
          options: ["a) hardly", "b) harding", "c) harder", "d) hard"],
          correctAnswer: "d",
        },
        {
          question:
            "29. The ... design of the new smartphone has attracted a lot of attention from tech enthusiasts.",
          options: ["A. elegance", "B. elegantly", "C. elegant", "D. elegancy"],
          correctAnswer: "c",
        },
        {
          question:
            "30. Please feel free to contact me with any questions about the project I have ... on.",
          options: [
            "A. work",
            "B. working",
            "C. been working",
            "D. been worked",
          ],
          correctAnswer: "c",
        },
        {
          question:
            "31. The editor apologized for the misprint and ... a correction.",
          options: [
            "A. publication",
            "B. destruction",
            "C. published",
            "D. publishes",
          ],
          correctAnswer: "c",
        },
        {
          question:
            "32. I will take a lot of what I have learned with me in my career and look back at my time here as a... of my professional life.",
          options: [
            "A. value period",
            "B. valuably period",
            "C. valuable period",
            "D. valuable periods",
          ],
          correctAnswer: "c",
        },
        {
          question:
            "33. I have ... another role that will halve my daily commute and allow me to spend more time with my family outside of working hours.",
          options: [
            "A. offered",
            "B. been offered",
            "C. being offered",
            "D. been offering",
          ],
          correctAnswer: "b",
        },
        {
          question:
            "34. This interview is our chance to ... our skills and abilities.",
          options: ["A. sold", "B. sells", "C. selling", "D. sell"],
          correctAnswer: "d",
        },
        {
          question:
            "35. During the next two weeks, I will do what I can to make the transition ... and will support in whatever I can to hand over my duties to colleagues or to my replacement.",
          options: [
            "A. as smoothly as possibly",
            "B. as smooth as possibly",
            "C. as smoothly as possible",
            "D. as smooth as possible",
          ],
          correctAnswer: "d",
        },
        {
          question:
            "36. Please make sure that all equipment … before leaving the office.",
          options: [
            "A. is turned off",
            "B. turning off",
            "C. to turn off",
            "D. turned off",
          ],
          correctAnswer: "a",
        },
        {
          question:
            "37. The new software update will be available for download … two weeks.",
          options: ["A. within", "B. between", "C. by", "D. for"],
          correctAnswer: "a",
        },
        {
          question:
            "38. If the shipment arrives early, we … able to meet the client's deadline.",
          options: [
            "A. would be",
            "B. will be",
            "C. are being",
            "D. have been",
          ],
          correctAnswer: "b",
        },
        {
          question: "39. The event will be postponed … the weather improves.",
          options: ["A. after", "B. until", "C. while", "D. during"],
          correctAnswer: "b",
        },
        {
          question: "40. Mr. Jack has ten years of … as a marketing manager.",
          options: [
            "A. extraordinary",
            "B. experience",
            "C. experiment",
            "D. extracurricular",
          ],
          correctAnswer: "b",
        },
      ];

      // Timer - Selalu mulai dari 20 menit
      let timeLeft = 20 * 60;
      const timerDisplay = document.getElementById("timer");

      function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `Time Remaining: ${minutes}:${
          seconds < 10 ? "0" : ""
        }${seconds}`;

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          alert("Time's up!");
          submitQuiz();
        }
        timeLeft--;
      }

      // Check if coming from another page
      window.addEventListener("beforeunload", function () {
        localStorage.setItem("readingTimeLeft", timeLeft);
      });

      const timerInterval = setInterval(updateTimer, 1000);

      // Fungsi untuk membuat elemen pertanyaan
      function createQuestionElements() {
        const quizForm = document.getElementById("reading-quiz");
        const navigationButtons = quizForm.querySelector(
          ".d-flex.justify-content-between"
        );

        // Hapus semua pertanyaan yang ada (jika ada)
        const existingQuestions = quizForm.querySelectorAll(
          ".question-container"
        );
        existingQuestions.forEach((q) => q.remove());

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const pageNum = Math.ceil(questionNum / questionsPerPage);

          const questionContainer = document.createElement("div");
          questionContainer.className = "question-container mb-4";
          questionContainer.dataset.page = pageNum;
          questionContainer.dataset.question = questionNum;
          questionContainer.style.display = "none";

          const questionDiv = document.createElement("div");
          questionDiv.className = "fw-bold mb-2";
          questionDiv.textContent = q.question;

          const optionsDiv = document.createElement("div");
          optionsDiv.className = "options";

          q.options.forEach((option, optIndex) => {
            const optionLetter = String.fromCharCode(97 + optIndex); // a, b, c, d
            const div = document.createElement("div");
            div.className = "form-check";

            const input = document.createElement("input");
            input.className = "form-check-input";
            input.type = "radio";
            input.name = `q${questionNum}`;
            input.id = `q${questionNum}_${optionLetter}`;
            input.value = optionLetter;

            const label = document.createElement("label");
            label.className = "form-check-label";
            label.htmlFor = `q${questionNum}_${optionLetter}`;
            label.textContent = option;

            div.appendChild(input);
            div.appendChild(label);
            optionsDiv.appendChild(div);
          });

          questionContainer.appendChild(questionDiv);
          questionContainer.appendChild(optionsDiv);
          quizForm.insertBefore(questionContainer, navigationButtons);
        });

        // Tampilkan halaman pertama
        showPage(1);
      }

      // Initialize question numbers
      const questionNumbersContainer =
        document.getElementById("questionNumbers");
      const totalQuestions = questions.length;

      function initializeQuestionNumbers() {
        questionNumbersContainer.innerHTML = "";

        for (let i = 1; i <= totalQuestions; i++) {
          const numberBtn = document.createElement("div");
          numberBtn.className = "question-number border rounded";
          numberBtn.textContent = i;
          numberBtn.dataset.question = i;
          numberBtn.addEventListener("click", () => {
            const pageNum = Math.ceil(i / questionsPerPage);
            showPage(pageNum);
            // Scroll to the specific question
            const questionElement = document.querySelector(
              `.question-container[data-question="${i}"]`
            );
            if (questionElement) {
              questionElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          });
          questionNumbersContainer.appendChild(numberBtn);
        }
      }

      // Track answered questions
      const answeredQuestions = new Set();

      // Add event listeners to all radio buttons
      function setupRadioButtonListeners() {
        document.querySelectorAll('input[type="radio"]').forEach((radio) => {
          radio.addEventListener("change", function () {
            const questionNum = this.name.substring(1);
            answeredQuestions.add(parseInt(questionNum));
            updateQuestionNumbers();

            // Simpan jawaban ke localStorage
            const userAnswers =
              JSON.parse(localStorage.getItem("userAnswers")) || {};
            userAnswers[`q${questionNum}`] = this.value;
            localStorage.setItem("userAnswers", JSON.stringify(userAnswers));
          });
        });
      }

      function updateQuestionNumbers() {
        document.querySelectorAll(".question-number").forEach((el) => {
          const questionNum = parseInt(el.dataset.question);
          el.classList.toggle("answered", answeredQuestions.has(questionNum));
          // Highlight current page questions
          const currentPageQuestions = Array.from(
            { length: questionsPerPage },
            (_, i) => (currentPage - 1) * questionsPerPage + i + 1
          );
          el.classList.toggle(
            "current",
            currentPageQuestions.includes(questionNum)
          );
        });
      }

      // Pagination logic
      let currentPage = 1;
      const totalPages = Math.ceil(totalQuestions / questionsPerPage);

      function showPage(pageNumber) {
        currentPage = pageNumber;
        const allQuestions = document.querySelectorAll(".question-container");
        allQuestions.forEach((q) => (q.style.display = "none"));

        // Show all questions for current page
        document
          .querySelectorAll(`.question-container[data-page="${pageNumber}"]`)
          .forEach((q) => (q.style.display = "block"));

        updateQuestionNumbers();
        updateNavigationButtons();

        // Scroll to top of questions
        const firstQuestion = document.querySelector(
          `.question-container[data-page="${pageNumber}"][data-question="${
            (pageNumber - 1) * questionsPerPage + 1
          }"]`
        );
        if (firstQuestion) {
          firstQuestion.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const submitPageBtn = document.getElementById("submitPageBtn");

        // Update Previous button
        prevBtn.disabled = currentPage === 1;

        // Update Next/Submit buttons
        if (currentPage === totalPages) {
          nextBtn.style.display = "none";
          submitPageBtn.style.display = "inline-block";
        } else {
          nextBtn.style.display = "inline-block";
          submitPageBtn.style.display = "none";
        }
      }

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
          showPage(currentPage - 1);
        }
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentPage < totalPages) {
          showPage(currentPage + 1);
        }
      });

      document.getElementById("submitPageBtn").addEventListener("click", () => {
        const modal = new bootstrap.Modal(
          document.getElementById("confirmModal")
        );
        modal.show();
      });

      // Initialize
      createQuestionElements();
      initializeQuestionNumbers();
      setupRadioButtonListeners();
      updateNavigationButtons();

      // Modal Confirmation
      document
        .getElementById("submitBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          const modal = new bootstrap.Modal(
            document.getElementById("confirmModal")
          );
          modal.show();
        });

      document
        .getElementById("confirmYes")
        .addEventListener("click", function () {
          submitQuiz();
        });

      document
        .getElementById("confirmNo")
        .addEventListener("click", function () {
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("confirmModal")
          );
          modal.hide();
        });

      // Submit Logic
      function submitQuiz() {
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("confirmModal")
        );
        modal.hide();
        clearInterval(timerInterval);

        let score = 0;
        const feedback = [];
        const questionDetails = {};
        const userAnswers = {};
        const categories = {
          comprehension: { correct: 0, total: 2 },
          details: { correct: 0, total: 5 },
          inference: { correct: 0, total: 3 },
        };

        // Definisi kategori soal
        const questionCategories = {
          q1: "comprehension",
          q2: "comprehension",
          q3: "inference",
          q4: "details",
          q5: "details",
          q6: "details",
          q7: "inference",
          q8: "details",
          q9: "comprehension",
          q10: "inference",
          q11: "comprehension",
          q12: "comprehension",
          q13: "inference",
          q14: "details",
          q15: "details",
          q16: "details",
          q17: "inference",
        };

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const questionKey = `q${questionNum}`;
          const selected = document.querySelector(
            `input[name="q${questionNum}"]:checked`
          );
          const userAnswer = selected ? selected.value : null;

          userAnswers[questionKey] = userAnswer;
          const isCorrect = selected && selected.value === q.correctAnswer;

          if (isCorrect) {
            score++;
            feedback.push({ question: questionNum, result: "✓" });
          } else {
            feedback.push({
              question: questionNum,
              result: "✗",
              correct: q.correctAnswer.toUpperCase(),
            });
          }

          // Update kategori
          const category = questionCategories[questionKey];
          if (category) {
            if (isCorrect) categories[category].correct += 1;
          }

          questionDetails[questionKey] = {
            yourAnswer: userAnswer ? userAnswer.toUpperCase() : "-",
            correctAnswer: q.correctAnswer.toUpperCase(),
            result: isCorrect ? "✓" : "✗",
          };
        });

        localStorage.setItem("quizScore", score);
        localStorage.setItem("totalQuestions", questions.length);
        localStorage.setItem("userAnswers", JSON.stringify(userAnswers));
        localStorage.setItem(
          "questionDetails",
          JSON.stringify(questionDetails)
        );
        localStorage.setItem("categories", JSON.stringify(categories));

        window.location.href = "result.html";
      }

      document
        .getElementById("reading-quiz")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          submitQuiz();
        });

      // Load saved answers
      // window.addEventListener("DOMContentLoaded", () => {
      //   const savedAnswers =
      //     JSON.parse(localStorage.getItem("userAnswers")) || {};
      //   Object.entries(savedAnswers).forEach(([questionName, answerValue]) => {
      //     const radio = document.querySelector(
      //       `input[name="${questionName}"][value="${answerValue}"]`
      //     );
      //     if (radio) {
      //       radio.checked = true;
      //       const questionNum = parseInt(questionName.substring(1));
      //       answeredQuestions.add(questionNum);
      //       updateQuestionNumbers();
      //     }
      //   });
      // });
    </script>
  </body>
</html>
