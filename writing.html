<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOEFL Writing Practice</title>
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Gaya CSS sama seperti sebelumnya */
      :root {
        --orange-primary: #f57f20;
        --orange-dark: #d16a1a;
        --orange-light: #fff5ee;
        --dark-text: #2a2a2a;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--orange-light);
        color: var(--dark-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header {
        background: linear-gradient(
          135deg,
          var(--orange-primary),
          var(--orange-dark)
        );
        color: white;
        padding: 60px 0 50px;
        margin-bottom: -30px;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }
      header:before {
        content: "";
        position: absolute;
        bottom: -50px;
        left: 0;
        width: 100%;
        height: 10px;
        background: var(--orange-light);
        transform: skewY(-2deg);
        z-index: -1;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        overflow: hidden;
      }
      .question-nav-container {
        width: 220px;
        position: sticky;
        top: 20px;
        height: fit-content;
        align-self: flex-start;
      }
      .question-nav {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        margin-bottom: 10px;
        padding: 15px;
        backdrop-filter: blur(5px);
      }
      .question-numbers {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
      }
      .question-number {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .question-number.answered {
        background-color: var(--orange-primary);
        color: white;
      }
      .question-number.current {
        border: 2px solid var(--orange-dark);
        font-weight: bold;
        background-color: var(--orange-light);
        color: var(--orange-dark);
      }
      .question-number.locked {
        background-color: #ffebee;
        color: #c62828;
        font-weight: bold;
        cursor: not-allowed;
      }
      #timer-container {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        text-align: center;
        font-weight: bold;
        padding: 15px;
        margin-bottom: 10px;
        backdrop-filter: blur(5px);
      }
      #timer {
        font-size: 1.1rem;
        color: var(--orange-dark);
      }
      .writing-section {
        background-color: white;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-top: 20px;
      }
      .picture-prompt {
        max-width: 100%;
        border-radius: 12px;
        margin-bottom: 15px;
        border: 2px solid var(--orange-primary);
      }
      .email-preview {
        background-color: #f8f9fa;
        padding: 15px;
        border-left: 4px solid var(--orange-primary);
        border-radius: 8px;
        margin-bottom: 15px;
      }
      textarea {
        width: 100%;
        min-height: 150px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        resize: vertical;
        transition: border-color 0.3s ease;
      }
      textarea:focus {
        border-color: var(--orange-primary);
        outline: none;
        box-shadow: 0 0 5px rgba(245, 127, 32, 0.4);
      }
      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--orange-primary),
          var(--orange-dark)
        );
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(245, 127, 32, 0.4);
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 16px;
        width: 400px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      footer {
        margin-top: auto;
        background: linear-gradient(135deg, var(--orange-dark), #b85c18);
        color: white;
        padding: 25px 0;
        position: relative;
        text-align: center;
      }
      footer:before {
        content: "";
        position: absolute;
        top: -20px;
        left: 0;
        width: 100%;
        height: 40px;
        background: var(--orange-light);
        transform: skewY(1.5deg);
        z-index: -1;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="container-fluid text-center py-4">
      <div class="container">
        <h1 class="mb-3">TOEFL Writing Practice Test</h1>
        <p class="lead">Complete the writing tasks below carefully.</p>
      </div>
    </header>

    <div class="container my-5">
      <div class="row">
        <div class="col-md-3">
          <div class="question-nav-container">
            <div class="question-nav glass-card mb-3">
              <h4 class="text-center mb-3">
                <i class="fas fa-list-ul me-2"></i> Questions
              </h4>
              <div class="question-numbers" id="questionNumbers"></div>
            </div>
            <div id="timer-container" class="glass-card mb-3">
              <div id="timer">
                <i class="fas fa-clock me-2"></i> Time Remaining: --:--
              </div>
            </div>
            <div class="glass-card p-3">
              <button
                type="submit"
                class="btn btn-primary w-100"
                id="submitBtn"
              >
                <i class="fas fa-paper-plane me-2"></i> Submit Answers
              </button>
            </div>
          </div>
        </div>

        <div class="col-md-9">
          <div class="writing-section glass-card">
            <form id="writing-quiz">
              <h3><i class="fas fa-edit me-2"></i> Section II: Writing</h3>
              <p>
                In this section, you will complete several writing tasks. The
                total time is 60 minutes.
              </p>
              <div
                class="navigation-buttons d-flex justify-content-between mt-4"
              >
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="prevBtn"
                  disabled
                >
                  <i class="fas fa-arrow-left me-2"></i> Previous
                </button>
                <button type="button" class="btn btn-success" id="nextBtn">
                  Next <i class="fas fa-arrow-right ms-2"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  id="submitPageBtn"
                  style="display: none"
                >
                  Submit All <i class="fas fa-check ms-2"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Confirmation -->
    <div id="confirmModal" class="modal">
      <div class="modal-content">
        <h4>
          <i class="fas fa-exclamation-triangle text-orange me-2"></i> Confirm
          Submission
        </h4>
        <p>You won't be able to change your answers after submitting.</p>
        <div class="d-flex justify-content-center gap-3 mt-4">
          <button id="confirmYes" class="btn btn-success">Yes, Submit</button>
          <button id="confirmNo" class="btn btn-danger">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="container-fluid py-3">
      <div class="container">
        <p class="small mb-0">Â© 2025 TOEIC Tester | Practice Language Skills</p>
      </div>
    </footer>

    <script>
      const questionsPerPage = 5;
      const totalTime = 60 * 60; // 60 menit dalam detik
      let timeLeft =
        parseInt(localStorage.getItem("remainingTime")) || totalTime;

      const questions = [
        // Data pertanyaan tetap sama seperti sebelumnya
        {
          type: "picture",
          question:
            "1. Write a sentence based on the picture below using the two words provided.",
          words: "friend/camp",
          imageUrl: "src/assets/q1.png",
          response: "",
        },
        {
          type: "picture",
          question:
            "2. Write a sentence based on the picture below using the two words provided.",
          words: "cashier/pay",
          imageUrl: "src/assets/q2.png",
          response: "",
        },
        {
          type: "picture",
          question:
            "3. Write a sentence based on the picture below using the two words provided.",
          words: "grandfather/garden",
          imageUrl: "src/assets/q3.png",
          response: "",
        },
        {
          type: "picture",
          question:
            "4. Write a sentence based on the picture below using the two words provided.",
          words: "clean/before",
          imageUrl: "src/assets/q4.png",
          response: "",
        },
        {
          type: "picture",
          question:
            "5. Write a sentence based on the picture below using the two words provided.",
          words: "circus/perform",
          imageUrl: "src/assets/q5.png",
          response: "",
        },
        {
          type: "email",
          question:
            "6. Respond to the email below. Describe ONE issue you have encountered with the HP 27inch All-in-One Desktop PC and make ONE request for assistance.",
          email: {
            from: "IDN Computer Jakarta Pusat",
            to: "Valued Customer",
            subject: "Thank you for choosing IDN Computer Jakarta Pusat",
            date: "March 5, 9:00 a.m.",
            body: "We are thrilled to have you as a valued customer of IDN Computer Jakarta Pusat! Thank you for your recent purchase of the HP 27inch All-in-One Desktop PC. We hope you are enjoying the cutting-edge features and performance of our product. Should you encounter any difficulties or have any questions, please feel free to reach out to us at idncomp.jakpusservice@gmail.com.",
          },
          response: "",
        },
        {
          type: "email",
          question:
            "7. Respond to the email below. Describe ONE problem that makes you unable to do the request. In your email, offer ONE solution for the sender.",
          email: {
            from: "Danis Peterson",
            to: "Rosaline Rice",
            subject: "Request for Updated Sales Report",
            date: "January 15, 10:00 a.m.",
            body: "Could you please send me the updated sales report for the third quarter by tomorrow afternoon? I need it for an important presentation. Let me know if you need any additional information.",
          },
          response: "",
        },
        {
          type: "essay",
          question:
            "8. Some individuals claim that technology leads to increased isolation and reduced social interaction, whereas others believe that it improves communication and fosters connections. What is your perspective on this matter? Please clarify your opinion and provide supporting reasons.",
          minWords: 300,
          response: "",
        },
      ];

      let timerInterval;
      const timerDisplay = document.getElementById("timer");
      const answeredQuestions = new Set();
      let currentPage = 1;
      const totalPages = Math.ceil(questions.length / questionsPerPage);

      function updateTimerDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `Time Remaining: ${minutes}:${
          seconds < 10 ? "0" : ""
        }${seconds}`;
      }

      function startGlobalTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();
          localStorage.setItem("remainingTime", timeLeft);
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            lockAllResponses();
          }
        }, 1000);
      }

      function lockAllResponses() {
        document.querySelectorAll("textarea").forEach((ta) => {
          ta.readOnly = true;
          ta.style.backgroundColor = "#f5f5f5";
          ta.placeholder = "Time's up! This response is locked";
        });
        document.querySelectorAll(".question-number").forEach((el) => {
          el.classList.add("locked");
          el.textContent += " ðŸ”’";
        });
      }

      function createQuestionElements() {
        const quizForm = document.getElementById("writing-quiz");
        const navigationButtons = quizForm.querySelector(".navigation-buttons");

        const existing = quizForm.querySelectorAll(".question-container");
        existing.forEach((q) => q.remove());

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const pageNum = Math.ceil(questionNum / questionsPerPage);
          const container = document.createElement("div");
          container.className = "question-container";
          container.dataset.page = pageNum;
          container.dataset.question = questionNum;
          container.style.display = "none";

          const div = document.createElement("div");
          div.className = "question mb-3";

          if (q.type === "picture") {
            div.innerHTML = `
          <h4>${q.question}</h4>
          <p><strong>Use these words:</strong> ${q.words}</p>
          <img src="${q.imageUrl}" alt="Writing prompt" class="picture-prompt">
          <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your sentence here...">${q.response}</textarea>`;
          } else if (q.type === "email") {
            div.innerHTML = `
          <h4>${q.question}</h4>
          <div class="email-preview">
            <p><strong>From:</strong> ${q.email.from}</p>
            <p><strong>To:</strong> ${q.email.to}</p>
            <p><strong>Subject:</strong> ${q.email.subject}</p>
            <p><strong>Sent:</strong> ${q.email.date}</p>
            <p>${q.email.body}</p>
          </div>
          <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your email response here...">${q.response}</textarea>`;
          } else if (q.type === "essay") {
            div.innerHTML = `
          <h4>${q.question}</h4>
          <p><strong>Minimum words:</strong> ${q.minWords}</p>
          <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your essay here..." style="min-height: 300px;">${q.response}</textarea>
          <div id="q${questionNum}-wordcount" class="text-muted">Word count: 0</div>`;
            const ta = div.querySelector(`#q${questionNum}-response`);
            const wc = div.querySelector(`#q${questionNum}-wordcount`);
            ta.addEventListener("input", () => {
              const wordCount = ta.value.trim()
                ? ta.value.trim().split(/\s+/).length
                : 0;
              wc.textContent = `Word count: ${wordCount}`;
              q.response = ta.value;
            });
          }

          container.appendChild(div);
          quizForm.insertBefore(container, navigationButtons);
        });

        showPage(1);
      }

      function setupTextareaListeners() {
        document.querySelectorAll("textarea").forEach((ta) => {
          const questionNum = parseInt(ta.id.split("-")[0].substring(1));
          ta.addEventListener("input", () => {
            if (timeLeft <= 0) return;
            questions[questionNum - 1].response = ta.value;
            if (ta.value.trim().length > 0) answeredQuestions.add(questionNum);
            else answeredQuestions.delete(questionNum);
            updateQuestionNumbers();
            localStorage.setItem("writingResponses", JSON.stringify(questions));
          });
        });
      }

      function initializeQuestionNumbers() {
        const container = document.getElementById("questionNumbers");
        container.innerHTML = "";
        questions.forEach((_, i) => {
          const num = i + 1;
          const el = document.createElement("div");
          el.className = "question-number";
          el.dataset.question = num;
          el.textContent = num;
          el.addEventListener("click", () => {
            const page = Math.ceil(num / questionsPerPage);
            showPage(page);
            setTimeout(() => {
              const target = document.querySelector(
                `.question-container[data-question="${num}"]`
              );
              target?.scrollIntoView({ behavior: "smooth", block: "start" });
            }, 100);
          });
          container.appendChild(el);
        });
        updateQuestionNumbers();
      }

      function updateQuestionNumbers() {
        document.querySelectorAll(".question-number").forEach((el) => {
          const num = parseInt(el.dataset.question);
          el.classList.toggle("answered", answeredQuestions.has(num));
        });
      }

      function showPage(pageNumber) {
        currentPage = pageNumber;
        document
          .querySelectorAll(".question-container")
          .forEach((q) => (q.style.display = "none"));
        document
          .querySelectorAll(`.question-container[data-page="${pageNumber}"]`)
          .forEach((q) => (q.style.display = "block"));
        updateQuestionNumbers();
        updateNavigationButtons();
      }

      function updateNavigationButtons() {
        document.getElementById("prevBtn").disabled = currentPage === 1;
        if (currentPage === totalPages) {
          document.getElementById("nextBtn").style.display = "none";
          document.getElementById("submitPageBtn").style.display =
            "inline-block";
        } else {
          document.getElementById("nextBtn").style.display = "inline-block";
          document.getElementById("submitPageBtn").style.display = "none";
        }
      }

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) showPage(currentPage - 1);
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentPage < totalPages) showPage(currentPage + 1);
      });

      document.getElementById("submitPageBtn").addEventListener("click", () => {
        document.getElementById("confirmModal").style.display = "flex";
      });

      document.getElementById("submitBtn").addEventListener("click", () => {
        document.getElementById("confirmModal").style.display = "flex";
      });

      document
        .getElementById("confirmYes")
        .addEventListener("click", submitTest);
      document.getElementById("confirmNo").addEventListener("click", () => {
        document.getElementById("confirmModal").style.display = "none";
      });

      function submitTest() {
        clearInterval(timerInterval);
        localStorage.removeItem("remainingTime");
        localStorage.removeItem("writingResponses");
        localStorage.removeItem("answeredQuestions");
        window.location.href = "result_writing.html";
      }

      window.addEventListener("DOMContentLoaded", () => {
        const submitted = localStorage.getItem("submittedOnce");
        if (!submitted) {
          const savedResponses =
            JSON.parse(localStorage.getItem("writingResponses")) || [];
          savedResponses.forEach((res, i) => {
            if (res?.response) {
              questions[i].response = res.response;
              answeredQuestions.add(i + 1);
            }
          });
        } else {
          // Jika sudah submit, reset semua jawaban
          questions.forEach((q) => (q.response = ""));
          answeredQuestions.clear();
        }

        createQuestionElements();
        initializeQuestionNumbers();
        setupTextareaListeners();
        updateNavigationButtons();
        updateTimerDisplay();
        startGlobalTimer();
      });
    </script>
  </body>
</html>
