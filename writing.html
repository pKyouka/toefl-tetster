<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOEFL Writing Practice</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .question-nav-container {
        width: 220px;
        position: sticky;
        top: 20px;
        height: fit-content;
        align-self: flex-start;
      }

      .question-nav {
        background-color: #f5f5f5;
        border-radius: 5px;
        margin-bottom: 10px;
      }

      .question-numbers {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }

      .question-number {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
      }

      .question-number.answered {
        background-color: #e0e0e0;
      }

      .question-number.current {
        border: 2px solid #4caf50;
        font-weight: bold;
      }

      #timer-container {
        background-color: #f5f5f5;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .writing-content {
        flex: 1;
        overflow-y: auto;
        max-height: calc(100vh - 160px);
      }

      .writing-section {
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .question-container {
        margin-bottom: 25px;
        display: none;
      }

      .picture-prompt {
        max-width: 100%;
        height: auto;
        margin-bottom: 15px;
        border: 1px solid #ddd;
      }

      .email-preview {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 15px;
      }

      .email-header {
        font-weight: bold;
        margin-bottom: 10px;
      }

      textarea {
        width: 100%;
        min-height: 150px;
        margin-bottom: 15px;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: white;
        padding: 25px;
        border-radius: 8px;
        width: 350px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <header class="container text-center py-4">
      <h1>TOEFL Writing Practice Test</h1>
      <p>Complete the writing tasks below.</p>
    </header>

    <div class="container mb-4">
      <div class="row">
        <!-- Left column -->
        <div class="col-md-3">
          <div class="question-nav-container">
            <div class="question-nav p-3 mb-3">
              <h3 class="text-center m-0 mb-3">Questions</h3>
              <div class="question-numbers" id="questionNumbers"></div>
            </div>

            <div id="timer-container" class="p-3 mb-3">
              <div id="timer">Time Remaining: --:--</div>
            </div>

            <div class="p-3 bg-light rounded">
              <button
                type="submit"
                class="btn btn-primary w-100"
                id="submitBtn"
              >
                Submit Answers
              </button>
            </div>
          </div>
        </div>

        <!-- Right column - questions -->
        <div class="col-md-9">
          <div class="writing-content">
            <div class="writing-section p-4 mb-4">
              <div class="mb-4">
                <h2>Section II: Writing</h2>
                <p>
                  In the writing test, you will complete several different types
                  of writing tasks. The entire writing test will last
                  approximately 50 minutes. You are encouraged to manage your
                  time carefully between the different sections.
                </p>
              </div>

              <form id="writing-quiz">
                <!-- Questions will be dynamically created by script -->

                <div
                  class="navigation-buttons d-flex justify-content-between mt-4"
                >
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="prevBtn"
                    disabled
                  >
                    Previous
                  </button>
                  <button type="button" class="btn btn-success" id="nextBtn">
                    Next
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary"
                    id="submitPageBtn"
                    style="display: none"
                  >
                    Submit Answers
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="confirmModal" class="modal">
      <div class="modal-content">
        <h3>Are you sure it's finished?</h3>
        <p>You won't be able to change your answers after submitting.</p>
        <div class="d-flex justify-content-center gap-3 mt-4">
          <button id="confirmYes" class="btn btn-success">Yes, Submit</button>
          <button id="confirmNo" class="btn btn-danger">No, Continue</button>
        </div>
      </div>
    </div>

    <footer class="container text-center py-3 text-muted">
      <p class="small">
        Â© 2025 IELTS Tester | Practice Writing Skills | Andaliman Books
      </p>
    </footer>

    <script>
      // Data pertanyaan
      const questionsPerPage = 5;
      const questions = [
        {
          type: "picture",
          question:
            "1. Write a sentence based on the picture below using the two words provided.",
          words: "friend/camp",
          imageUrl: "src/assets/q1.png",
          response: "",
          timeLimit: 60, // 1 minute per question
        },
        {
          type: "picture",
          question:
            "2. Write a sentence based on the picture below using the two words provided.",
          words: "cashier/pay",
          imageUrl: "src/assets/q2.png",
          response: "",
          timeLimit: 60,
        },
        {
          type: "picture",
          question:
            "3. Write a sentence based on the picture below using the two words provided.",
          words: "grandfather/garden",
          imageUrl: "src/assets/q3.png",
          response: "",
          timeLimit: 60,
        },
        {
          type: "picture",
          question:
            "4. Write a sentence based on the picture below using the two words provided.",
          words: "clean/before",
          imageUrl: "src/assets/q4.png",
          response: "",
          timeLimit: 60,
        },
        {
          type: "picture",
          question:
            "5. Write a sentence based on the picture below using the two words provided.",
          words: "circus/perform",
          imageUrl: "src/assets/q5.png",
          response: "",
          timeLimit: 60,
        },
        {
          type: "email",
          question:
            "6. Respond to the email below. Describe ONE issue you have encountered with the HP 27inch All-in-One Desktop PC and make ONE request for assistance.",
          email: {
            from: "IDN Computer Jakarta Pusat",
            to: "Valued Customer",
            subject: "Thank you for choosing IDN Computer Jakarta Pusat",
            date: "March 5, 9:00 a.m.",
            body: "We are thrilled to have you as a valued customer of IDN Computer Jakarta Pusat! Thank you for your recent purchase of the HP 27inch All-in-One Desktop PC. We hope you are enjoying the cutting-edge features and performance of our product. Should you encounter any difficulties or have any questions, please feel free to reach out to us at idncomp.jakpusservice@gmail.com.",
          },
          response: "",
          timeLimit: 300, // 5 minutes
        },
        {
          type: "email",
          question:
            "7. Respond to the email below. Describe ONE problem that makes you unable to do the request. In your email, offer ONE solution for the sender.",
          email: {
            from: "Danis Peterson",
            to: "Rosaline Rice",
            subject: "Request for Updated Sales Report",
            date: "January 15, 10:00 a.m.",
            body: "Could you please send me the updated sales report for the third quarter by tomorrow afternoon? I need it for an important presentation. Let me know if you need any additional information.",
          },
          response: "",
          timeLimit: 300,
        },
        {
          type: "essay",
          question:
            "8. Some individuals claim that technology leads to increased isolation and reduced social interaction, whereas others believe that it improves communication and fosters connections. What is your perspective on this matter? Please clarify your opinion and provide supporting reasons.",
          minWords: 300,
          response: "",
          timeLimit: 1200, // 20 minutes
        },
      ];

      // Timer variables
      let currentQuestionIndex = 0;
      let timeLeft = 0;
      let timerInterval;
      const timerDisplay = document.getElementById("timer");

      function startTimer(duration) {
        timeLeft = duration;
        updateTimerDisplay();

        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();

          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            if (currentQuestionIndex < questions.length - 1) {
              moveToNextQuestion();
            } else {
              submitTest();
            }
          }
        }, 1000);
      }

      function updateTimerDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `Time Remaining: ${minutes}:${
          seconds < 10 ? "0" : ""
        }${seconds}`;
      }

      // Fungsi untuk membuat elemen pertanyaan
      function createQuestionElements() {
        const quizForm = document.getElementById("writing-quiz");
        const navigationButtons = quizForm.querySelector(".navigation-buttons");

        // Hapus semua pertanyaan yang ada (jika ada)
        const existingQuestions = quizForm.querySelectorAll(
          ".question-container"
        );
        existingQuestions.forEach((q) => q.remove());

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const pageNum = Math.ceil(questionNum / questionsPerPage);

          const questionContainer = document.createElement("div");
          questionContainer.className = "question-container";
          questionContainer.dataset.page = pageNum;
          questionContainer.dataset.question = questionNum;
          questionContainer.style.display = "none";

          const questionDiv = document.createElement("div");
          questionDiv.className = "question mb-3";

          if (q.type === "picture") {
            questionDiv.innerHTML = `
              <h4>${q.question}</h4>
              <p><strong>Use these words:</strong> ${q.words}</p>
              ${
                q.imageUrl
                  ? `<img src="${q.imageUrl}" alt="Writing prompt" class="picture-prompt">`
                  : "<p>[Image placeholder]</p>"
              }
              <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your sentence here...">${
              q.response
            }</textarea>
            `;
          } else if (q.type === "email") {
            questionDiv.innerHTML = `
              <h4>${q.question}</h4>
              <div class="email-preview">
                <div class="email-header">
                  <p><strong>From:</strong> ${q.email.from}</p>
                  <p><strong>To:</strong> ${q.email.to}</p>
                  <p><strong>Subject:</strong> ${q.email.subject}</p>
                  <p><strong>Sent:</strong> ${q.email.date}</p>
                </div>
                <p>${q.email.body}</p>
              </div>
              <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your email response here...">${q.response}</textarea>
            `;
          } else if (q.type === "essay") {
            questionDiv.innerHTML = `
              <h4>${q.question}</h4>
              <p><strong>Minimum words:</strong> ${q.minWords}</p>
              <textarea id="q${questionNum}-response" class="form-control" placeholder="Write your essay here..." style="min-height: 300px;">${q.response}</textarea>
              <div id="q${questionNum}-wordcount" class="text-muted">Word count: 0</div>
            `;

            // Add word count functionality for essays
            const textarea = questionDiv.querySelector(
              `#q${questionNum}-response`
            );
            const wordCountDisplay = questionDiv.querySelector(
              `#q${questionNum}-wordcount`
            );

            textarea.addEventListener("input", function () {
              const wordCount =
                this.value.trim() === ""
                  ? 0
                  : this.value.trim().split(/\s+/).length;
              wordCountDisplay.textContent = `Word count: ${wordCount}`;
              q.response = this.value;
            });
          }

          questionContainer.appendChild(questionDiv);
          quizForm.insertBefore(questionContainer, navigationButtons);
        });

        // Tampilkan halaman pertama
        showPage(1);
      }

      // Initialize question numbers
      const questionNumbersContainer =
        document.getElementById("questionNumbers");
      const totalQuestions = questions.length;

      function initializeQuestionNumbers() {
        questionNumbersContainer.innerHTML = "";

        for (let i = 1; i <= totalQuestions; i++) {
          const numberBtn = document.createElement("div");
          numberBtn.className = "question-number";
          numberBtn.textContent = i;
          numberBtn.dataset.question = i;
          numberBtn.addEventListener("click", () => {
            const pageNum = Math.ceil(i / questionsPerPage);
            showPage(pageNum);
            // Scroll to the specific question
            const questionElement = document.querySelector(
              `.question-container[data-question="${i}"]`
            );
            if (questionElement) {
              questionElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          });
          questionNumbersContainer.appendChild(numberBtn);
        }
      }

      // Track answered questions
      const answeredQuestions = new Set();

      // Add event listeners to all textareas
      function setupTextareaListeners() {
        document.querySelectorAll("textarea").forEach((textarea) => {
          textarea.addEventListener("input", function () {
            const questionNum = this.id.split("-")[0].substring(1);

            if (this.value.trim().length > 0) {
              answeredQuestions.add(parseInt(questionNum));
            } else {
              answeredQuestions.delete(parseInt(questionNum));
            }

            updateQuestionNumbers();

            // Save response
            questions[questionNum - 1].response = this.value;
            localStorage.setItem("writingResponses", JSON.stringify(questions));
          });
        });
      }

      function updateQuestionNumbers() {
        document.querySelectorAll(".question-number").forEach((el) => {
          const questionNum = parseInt(el.dataset.question);
          el.classList.toggle("answered", answeredQuestions.has(questionNum));
          // Highlight current page questions
          const currentPageQuestions = Array.from(
            { length: questionsPerPage },
            (_, i) => (currentPage - 1) * questionsPerPage + i + 1
          );
          el.classList.toggle(
            "current",
            currentPageQuestions.includes(questionNum)
          );
        });
      }

      // Pagination logic
      let currentPage = 1;
      const totalPages = Math.ceil(totalQuestions / questionsPerPage);

      function showPage(pageNumber) {
        currentPage = pageNumber;
        const allQuestions = document.querySelectorAll(".question-container");
        allQuestions.forEach((q) => (q.style.display = "none"));

        // Show all questions for current page
        document
          .querySelectorAll(`.question-container[data-page="${pageNumber}"]`)
          .forEach((q) => (q.style.display = "block"));

        updateQuestionNumbers();
        updateNavigationButtons();

        // Scroll to top of questions
        const firstQuestion = document.querySelector(
          `.question-container[data-page="${pageNumber}"][data-question="${
            (pageNumber - 1) * questionsPerPage + 1
          }"]`
        );
        if (firstQuestion) {
          firstQuestion.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        // Start timer for the first question on this page
        const firstQuestionIndex = (pageNumber - 1) * questionsPerPage;
        currentQuestionIndex = firstQuestionIndex;
        startTimer(questions[firstQuestionIndex].timeLimit);
      }

      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const submitPageBtn = document.getElementById("submitPageBtn");

        // Update Previous button
        prevBtn.disabled = currentPage === 1;

        // Update Next/Submit buttons
        if (currentPage === totalPages) {
          nextBtn.style.display = "none";
          submitPageBtn.style.display = "inline-block";
        } else {
          nextBtn.style.display = "inline-block";
          submitPageBtn.style.display = "none";
        }
      }

      function moveToNextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
          currentQuestionIndex++;
          const pageNum = Math.ceil(
            (currentQuestionIndex + 1) / questionsPerPage
          );
          showPage(pageNum);
        }
      }

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
          showPage(currentPage - 1);
        }
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentPage < totalPages) {
          showPage(currentPage + 1);
        }
      });

      document.getElementById("submitPageBtn").addEventListener("click", () => {
        document.getElementById("confirmModal").style.display = "flex";
      });

      // Initialize
      createQuestionElements();
      initializeQuestionNumbers();
      setupTextareaListeners();
      updateNavigationButtons();

      // Load saved responses
      window.addEventListener("DOMContentLoaded", () => {
        const savedResponses =
          JSON.parse(localStorage.getItem("writingResponses")) || questions;

        savedResponses.forEach((response, index) => {
          if (index < questions.length) {
            questions[index].response = response.response || "";
            const textarea = document.querySelector(`#q${index + 1}-response`);
            if (textarea) {
              textarea.value = questions[index].response;

              if (questions[index].response.trim().length > 0) {
                answeredQuestions.add(index + 1);
              }
            }
          }
        });

        updateQuestionNumbers();

        // Update word counts for essays
        questions.forEach((q, index) => {
          if (q.type === "essay" && q.response) {
            const wordCountDisplay = document.querySelector(
              `#q${index + 1}-wordcount`
            );
            if (wordCountDisplay) {
              const wordCount =
                q.response.trim() === ""
                  ? 0
                  : q.response.trim().split(/\s+/).length;
              wordCountDisplay.textContent = `Word count: ${wordCount}`;
            }
          }
        });
      });

      // Modal Confirmation
      document
        .getElementById("submitBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("confirmModal").style.display = "flex";
        });

      document
        .getElementById("confirmYes")
        .addEventListener("click", function () {
          submitTest();
        });

      document
        .getElementById("confirmNo")
        .addEventListener("click", function () {
          document.getElementById("confirmModal").style.display = "none";
        });

      // Submit Logic
      function submitTest() {
        document.getElementById("confirmModal").style.display = "none";
        clearInterval(timerInterval);

        // Save all responses
        localStorage.setItem("writingResponses", JSON.stringify(questions));
        alert("Your writing test has been submitted!");
        // Here you would typically redirect to a results page or similar
      }

      document
        .getElementById("writing-quiz")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          submitTest();
        });

      // Disable right-click and other protections
      document.addEventListener("contextmenu", (e) => e.preventDefault());
      document.addEventListener("selectstart", (e) => e.preventDefault());
      document.addEventListener("copy", (e) => e.preventDefault());
      document.addEventListener("cut", (e) => e.preventDefault());
      document.addEventListener("dragstart", (e) => e.preventDefault());

      document.addEventListener("keydown", function (event) {
        if (
          (event.ctrlKey &&
            (event.key === "c" ||
              event.key === "v" ||
              event.key === "x" ||
              event.key === "a")) ||
          event.key === "F12" ||
          event.key === "PrintScreen"
        ) {
          event.preventDefault();
        }
      });
    </script>
  </body>
</html>
