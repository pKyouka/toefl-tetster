<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOEIC Listening Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      :root {
        --primary: #ff8c00;
        --primary-dark: #e67e00;
        --primary-light: #fff5e6;
        --dark-text: #2a2a2a;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--primary-light);
        color: var(--dark-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        padding: 60px 0 50px;
        margin-bottom: -30px;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      header:before {
        content: "";
        position: absolute;
        bottom: -50px;
        left: 0;
        width: 100%;
        height: 10px;
        background: var(--primary-light);
        transform: skewY(-2deg);
        z-index: -1;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        overflow: hidden;
      }

      .question-nav-container {
        width: 220px;
        position: sticky;
        top: 20px;
        height: fit-content;
        align-self: flex-start;
      }

      .question-nav {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        margin-bottom: 10px;
        padding: 15px;
        backdrop-filter: blur(5px);
      }

      .question-numbers {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
      }

      .question-number {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .question-number.answered {
        background-color: var(--primary);
        color: white;
      }

      .question-number.current {
        border: 2px solid var(--primary-dark);
        font-weight: bold;
        background-color: var(--primary-light);
        color: var(--primary-dark);
      }

      #timer-container {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        text-align: center;
        font-weight: bold;
        padding: 15px;
        margin-bottom: 10px;
        backdrop-filter: blur(5px);
      }

      #timer {
        font-size: 1.1rem;
        color: var(--primary-dark);
      }

      .listening-content {
        flex: 1;
        overflow-y: auto;
        max-height: calc(100vh - 160px);
      }

      .listening-section {
        background-color: white;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-top: 20px;
      }

      .custom-audio-player {
        background: linear-gradient(to right, #f0f0ff, #f8f8ff);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 25px rgba(68, 36, 185, 0.1);
        margin-bottom: 25px;
        position: relative;
        border: 1px solid rgba(68, 36, 185, 0.2);
      }
      
      .audio-controls {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }
      
      .play-btn {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        font-size: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(68, 36, 185, 0.3);
        margin-right: 20px;
      }
      
      .play-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.05);
      }
      
      .play-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }
      
      .audio-info {
        display: flex;
        flex-direction: column;
      }
      
      .audio-title {
        font-weight: 600;
        font-size: 1.2rem;
        color: var(--primary-dark);
        margin-bottom: 5px;
      }
      
      .audio-status {
        font-size: 0.9rem;
        color: #666;
        font-style: italic;
      }
      
      .progress-container {
        width: 100%;
        height: 10px;
        background: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        margin-top: 10px;
      }
      
      .progress-bar {
        height: 100%;
        background: var(--primary);
        width: 0;
        border-radius: 5px;
        transition: width 0.1s linear;
      }
      
      .time-display {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        color: #666;
        margin-top: 8px;
        font-weight: 500;
      }
      
      .playback-limit-notice {
        background-color: #fff4f4;
        border-left: 4px solid #ff4d4f;
        color: #cf222e;
        font-size: 0.9rem;
        font-weight: 500;
        margin-top: 15px;
        padding: 10px 15px;
        border-radius: 4px;
      }
      
      .audio-played {
        position: relative;
      }
      
      .audio-played::after {
        content: "âœ“";
        position: absolute;
        top: -8px;
        right: -8px;
        width: 25px;
        height: 25px;
        background: #198754;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .question-container {
        margin-bottom: 25px;
        display: none;
        background-color: #fcfcff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .question {
        font-weight: 500;
        margin-bottom: 15px;
        color: var(--primary-dark);
      }

      .options {
        margin-left: 10px;
      }

      .options label {
        display: block;
        margin: 10px 0;
        cursor: pointer;
        padding: 10px 15px;
        border-radius: 8px;
        transition: all 0.2s;
        background-color: #f7f7ff;
        border: 1px solid #e8e8ff;
      }

      .options label:hover {
        background-color: #eeeeff;
      }

      .options input[type="radio"] {
        margin-right: 10px;
      }

      .btn {
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        border: none;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(68, 36, 185, 0.4);
      }

      .btn-warning {
        background: linear-gradient(135deg, #f8b018, #e29700);
        border: none;
        color: white;
      }

      .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(242, 153, 74, 0.4);
        color: white;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 16px;
        width: 400px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      footer {
        margin-top: auto;
        background: linear-gradient(135deg, var(--primary-dark), #2d1980);
        color: white;
        padding: 25px 0;
        position: relative;
        text-align: center;
      }

      footer:before {
        content: "";
        position: absolute;
        top: -20px;
        left: 0;
        width: 100%;
        height: 40px;
        background: var(--primary-light);
        transform: skewY(1.5deg);
        z-index: -1;
      }
    </style>
  </head>
  <body>
    <header class="container-fluid text-center py-4">
      <div class="container">
        <h1 class="mb-3">TOEIC Listening Practice Test</h1>
        <p class="lead">Listen carefully to the audio and answer the questions.</p>
      </div>
    </header>

    <div class="container my-5">
      <div class="row">
        <div class="col-md-3">
          <div class="question-nav-container">
            <div class="question-nav glass-card mb-3">
              <h4 class="text-center mb-3">
                <i class="fas fa-list-ul me-2"></i> Questions
              </h4>
              <div class="question-numbers" id="questionNumbers"></div>
            </div>
            <div id="timer-container" class="glass-card mb-3">
              <div id="timer">
                <i class="fas fa-clock me-2"></i> Time Remaining: 45:00
              </div>
            </div>
            <div class="glass-card p-3">
              <button type="submit" class="btn btn-primary w-100" id="submitBtn">
                <i class="fas fa-paper-plane me-2"></i> Submit Answers
              </button>
            </div>
          </div>
        </div>

        <div class="col-md-9">
          <div class="listening-section glass-card">
            <div class="passage mb-4">
              <h3><i class="fas fa-headphones-alt me-2"></i> SECTION I: LISTENING COMPREHENSION</h3>
              <p>
                In this section of the test, you will have the chance to show how well you understand spoken English. There are four parts to this section, with special directions for each part.
              </p>
              <p>
                <strong><i class="fas fa-exclamation-circle me-2"></i> Important:</strong> Each audio can only be played once to simulate real exam conditions. Listen carefully before answering the questions.
              </p>
            </div>

            <div class="custom-audio-player" id="customAudioPlayer">
              <div class="audio-controls">
                <button class="play-btn" id="playBtn">
                  <i class="fas fa-play" id="playIcon"></i>
                </button>
                <div class="audio-info">
                  <p class="audio-title" id="currentAudioTitle">Conversation 1</p>
                  <span class="audio-status" id="audioStatus">Ready to play</span>
                </div>
              </div>
              
              <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
              </div>
              
              <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="durationTime">0:00</span>
              </div>
              
              <div class="playback-limit-notice">
                <i class="fas fa-info-circle me-2"></i> Note: Each audio recording can only be played once to simulate exam conditions.
              </div>
              
              <!-- Hidden native audio element -->
              <audio id="mainAudio" style="display:none">
                <source src="src/assets/sound/q1.wav" type="audio/wav">
                Your browser does not support the audio element.
              </audio>
            </div>

            <form id="listening-quiz">
              <!-- Questions will be dynamically created by script -->
              <div class="navigation-buttons d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-secondary" id="prevBtn" disabled>
                  <i class="fas fa-arrow-left me-2"></i> Previous
                </button>
                <button type="button" class="btn btn-warning" id="nextBtn">
                  Next <i class="fas fa-arrow-right ms-2"></i>
                </button>
                <button type="button" class="btn btn-warning" id="submitPageBtn" style="display: none">
                  Submit All <i class="fas fa-check ms-2"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div id="confirmModal" class="modal">
      <div class="modal-content">
        <h4>
          <i class="fas fa-exclamation-triangle text-warning me-2"></i> Confirm Submission
        </h4>
        <p>You won't be able to change your answers after submitting.</p>
        <div class="d-flex justify-content-center gap-3 mt-4">
          <button id="confirmYes" class="btn btn-success">Yes, Submit</button>
          <button id="confirmNo" class="btn btn-danger">Cancel</button>
        </div>
      </div>
    </div>

    <footer class="container-fluid py-3">
      <div class="container">
        <p class="small mb-0">Â© 2025 TOEIC Tester | Practice Listening Skills</p>
      </div>
    </footer>

    <script>
      // Data pertanyaan - tetap sama seperti di listening.html asli
      const questionsPerPage = 5;
      const questions = [
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "1. <img src='src/assets/listeningPict/q1_listening.jpg' alt='Question 1 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "2. <img src='src/assets/listeningPict/q2_listening.jpg' alt='Question 2 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "3. <img src='src/assets/listeningPict/q3_listening.jpg' alt='Question 3 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "4. <img src='src/assets/listeningPict/q4_listening.jpg' alt='Question 4 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "5. <img src='src/assets/listeningPict/q5_listening.jpg' alt='Question 5 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "6. <img src='src/assets/listeningPict/q6_listening.jpg' alt='Question 6 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "7. <img src='src/assets/listeningPict/q7_listening.jpg' alt='Question 7 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "8. <img src='src/assets/listeningPict/q8_listening.jpg' alt='Question 8 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "9. <img src='src/assets/listeningPict/q9_listening.jpg' alt='Question 9 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q1.wav",
          title: "Conversation 1",
          question: "10. <img src='src/assets/listeningPict/q10_listening.jpg' alt='Question 10 Image' class='img-fluid rounded my-2'>",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "11.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "12.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "13.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "14.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "15.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "16.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "17.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "18.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "19.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "20.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "21.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "22.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "23.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "24.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "25.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "26.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "27.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "28.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "29.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "30.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "31.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "32.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "33.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "34.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "35.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "36.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "37.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "38.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "39.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q2.wav",
          title: "Conversation 2",
          question: "40.",
          options: [
            "A)",
            "B)",
            "C)",
            "D)"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "41. What is the main topic of the conversation?",
          options: [
            "A) A project update",
            "B) A new hire",
            "C) A company event",
            "D) A vacation plan"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "42. What does the customer want to know?",
          options: [
            "A) The warranty period",
            "B) The return process",
            "C) Product availability",
            "D) The price difference"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "43. What does the student need help with?",
          options: [
            "A) Formatting the report",
            "B) Finding sources",
            "C) Understanding the topic",
            "D) Meeting the deadline"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "44. How did his friend feel about the movie?",
          options: [
            "A) She loved it",
            "B) She didn't like it",
            "C) She was indifferent",
            "D) She hasn't seen it"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "45. What is the employee concerned about?",
          options: [
            "A) Job responsibilities",
            "B) Salary increase",
            "C) Training requirements",
            "D) Work-life balance"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "46. What is the client primarily interested in?",
          options: [
            "A) Budgeting",
            "B) Scheduling",
            "C) Project outcomes",
            "D) Team members"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "47. What is the customer's main complaint?",
          options: [
            "A) Delayed service",
            "B) Poor quality",
            "C) Incorrect billing",
            "D) Unfriendly staff"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "48. What type of event do they decide on?",
          options: [
            "A) A workshop",
            "B) A dinner",
            "C) An outing",
            "D) A competition"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "49. What study method does the student prefer?",
          options: [
            "A) Group study",
            "B) Flashcards",
            "C) Online resources",
            "D) Reading textbooks"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "50. What is the manager's main point?",
          options: [
            "A) Improve communication skills.",
            "B) Meet deadlines.",
            "C) Increase sales.",
            "D) Attend more meetings."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "51. What does the patient want to know?",
          options: [
            "A) Side effects",
            "B) Dosage",
            "C) Duration of treatment",
            "D) Cost"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "52. Where do they plan to go?",
          options: [
            "A) Europe",
            "B) Asia",
            "C) South America",
            "D) Australia"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "53. Why isn't the meeting date set yet?",
          options: [
            "A) Natalie hasn't asked Manuel about it.",
            "B) Everyone is busy on Friday.",
            "C) The secretary is out.",
            "D) Manuel's schedule is unclear."
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "54. What does the man think he forgot to do?",
          options: [
            "A) Pay the bill.",
            "B) Take his mobile phone.",
            "C) Take the receipt.",
            "D) Lock his car."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "55. How are the speakers getting to Tokyo?",
          options: [
            "A) By plane",
            "B) By bus",
            "C) By train",
            "D) By car"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "56. Who is the woman probably talking to?",
          options: [
            "A) A tailor",
            "B) A hair stylist",
            "C) A salesperson",
            "D) An artist"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "57. What do they agree on?",
          options: [
            "A) Working overtime is necessary.",
            "B) Taking breaks is important.",
            "C) Remote work is less productive.",
            "D) Networking is essential."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "58. What does the teacher recommend?",
          options: [
            "A) A challenging subject",
            "B) A popular elective",
            "C) A major requirement",
            "D) A remedial course"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "59. What does the client prioritize for the trip?",
          options: [
            "A) Cost",
            "B) Destination",
            "C) Duration",
            "D) Activities"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "60. When is the orientation?",
          options: [
            "A) Before lunch",
            "B) Early morning",
            "C) At noon",
            "D) After lunch"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "61. What is the man's complaint?",
          options: [
            "A) The office needs a new printer.",
            "B) The woman isn't friendly.",
            "C) The office equipment is breaking down.",
            "D) The printer is difficult to use."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "62. What are the speakers doing?",
          options: [
            "A) Meeting a traveller.",
            "B) Entering a building.",
            "C) Shopping for a hat.",
            "D) Walking down a narrow street."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "63. Why are the speakers leaving soon?",
          options: [
            "A) Their meeting starts in twenty minutes.",
            "B) There may be a lot of traffic.",
            "C) The plane is arriving early.",
            "D) The woman doesn't like driving."
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "64. Why might there be a drop in brokerage fees?",
          options: [
            "A) Because of new international banks.",
            "B) Because new banks are opening.",
            "C) Because of competition.",
            "D) Because of fewer investments"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "65. What does the man want to do?",
          options: [
            "A) Call a client.",
            "B) Use a room.",
            "C) Change his schedule.",
            "D) Pick up a check."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "66. When will they plan to meet?",
          options: [
            "A) This weekend",
            "B) On Tuesday",
            "C) Tomorrow morning",
            "D) Tonight"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "67. Where is the man?",
          options: [
            "A) On vacation",
            "B) In a theatre",
            "C) At an auto parts store",
            "D) At a camera store"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "68. Why will Joan be in George's office?",
          options: [
            "A) Joan is going to work for George.",
            "B) Electrical work is being done near her desk.",
            "C) They are cutting back on office space.",
            "D) Joan's office is being panelled."
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "69. What appears to be the problem?",
          options: [
            "A) The new boss isn't very productive.",
            "B) The factory needs to be renovated.",
            "C) There are personality conflicts.",
            "D) The foreman isn't experienced."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q3.wav",
          title: "Conversation 3",
          question: "70. What will the survey try to determine?",
          options: [
            "A) Traffic patterns",
            "B) Employment rates",
            "C) Elevator capacity requirements",
            "D) Worker satisfaction"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "71. What is the reason for the flight delay?",
          options: [
            "A) Weather conditions",
            "B) A technical problem",
            "C) Late passengers",
            "D) Security issues"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "72. What time will the flight now depart?",
          options: [
            "A) 4:30 p.m.",
            "B) 6:45 p.m.",
            "C) 5:00 p.m.",
            "D) 7:00 p.m."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "73. Which gate should passengers go to for boarding?",
          options: [
            "A) 14A",
            "B) 15B",
            "C) 13C",
            "D) 16B"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "74. What is the purpose of this talk?",
          options: [
            "A) To advertise a sale.",
            "B) To provide driving tips.",
            "C) To announce a new model.",
            "D) To introduce a dealership."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "75. How long is the financing offer available?",
          options: [
            "A) 12 months",
            "B) 24 months",
            "C) 36 months",
            "D) 48 months"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "76. What are the hours of operation this weekend?",
          options: [
            "A) 8 a.m. to 6 p.m.",
            "B) 9 a.m. to 7 p.m.",
            "C) 10 a.m. to 5 p.m.",
            "D) 9 a.m. to 5 p.m."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "77. What caused the increase in sales figures?",
          options: [
            "A) New products",
            "B) Lower prices",
            "C) Better marketing",
            "D) Increased demand"
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "78. What is the company's next goal?",
          options: [
            "A) To increase revenue by 20%",
            "B) To improve customer satisfaction",
            "C) To hire more staff",
            "D) To expand the business"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "79. How long do they plan to achieve their next goal?",
          options: [
            "A) 3 months",
            "B) 6 months",
            "C) 9 months",
            "D) 12 months"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "80. Why is the main swimming pool closed?",
          options: [
            "A) It's under renovation.",
            "B) It's being cleaned.",
            "C) It's closed for maintenance.",
            "D) It's being used for an event."
          ],
          correctAnswer: "a"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "81. What time does the rooftop pool open?",
          options: [
            "A) 7 a.m.",
            "B) 8 a.m.",
            "C) 9 a.m.",
            "D) 10 a.m."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "82. How long will the rooftop pool remain open today?",
          options: [
            "A) Until 6 p.m.",
            "B) Until 8 p.m.",
            "C) Until 9 p.m.",
            "D) Until 10 p.m."
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "83. What will the weather be like this morning?",
          options: [
            "A) Rainy",
            "B) Cloudy",
            "C) Sunny",
            "D) Windy"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "84. What is expected in the afternoon?",
          options: [
            "A) Heavy rain",
            "B) Clear skies",
            "C) Thunderstorms",
            "D) Snow"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "85. What will the temperature be overnight?",
          options: [
            "A) 55 degrees",
            "B) 60 degrees",
            "C) 65 degrees",
            "D) 70 degrees"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "86. Where is the company's new office located?",
          options: [
            "A) Paris",
            "B) Berlin",
            "C) Rome",
            "D) Madrid"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "87. What will the Berlin office focus on?",
          options: [
            "A) Marketing",
            "B) Research",
            "C) Sales and customer service",
            "D) Product development"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "88. When will the new product line be launched?",
          options: [
            "A) In January",
            "B) In February",
            "C) In March",
            "D) In April"
          ],
          correctAnswer: "d"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "89. Where will the tour begin?",
          options: [
            "A) At the cathedral",
            "B) At the old city square",
            "C) At the National Museum",
            "D) At a local craft shop"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "90. What will tourists do at the old city square?",
          options: [
            "A) Visit the museum.",
            "B) Take photos.",
            "C) Have free time to explore.",
            "D) Visit the cathedral."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "91. What is the last stop on the tour?",
          options: [
            "A) The National Museum",
            "B) The old city square",
            "C) The local craft market",
            "D) The cathedral"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "92. What is the main topic of the talk?",
          options: [
            "A) Stress management",
            "B) A balanced diet and exercise",
            "C) Medical treatments",
            "D) Weight loss programs"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "93. What will participants learn about meal planning?",
          options: [
            "A) Eating out.",
            "B) Portion control.",
            "C) Adding fruits and vegetables.",
            "D) Following specific diets."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "94. What kind of exercises will be discussed?",
          options: [
            "A) Advanced workout routines",
            "B) Gym-based exercises",
            "C) Exercises to do at home",
            "D) Group fitness activities"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "95. What type of announcement is being made?",
          options: [
            "A) A customer service announcement",
            "B) A clearance sale promotion",
            "C) A new product launch",
            "D) A store policy change"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "96. How much can customers save during the sale?",
          options: [
            "A) 10%",
            "B) 25%",
            "C) 50%",
            "D) 75%"
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "97. Where is the clearance section located?",
          options: [
            "A) On the first floor",
            "B) On the second floor",
            "C) Near the entrance",
            "D) In the electronics department"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "98. What is the destination of the train?",
          options: [
            "A) New York City",
            "B) Philadelphia",
            "C) Boston",
            "D) Washington, D.C."
          ],
          correctAnswer: "c"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "99. Where should passengers go to board the train?",
          options: [
            "A) Platform 1",
            "B) Platform 2",
            "C) Platform 3",
            "D) Platform 4"
          ],
          correctAnswer: "b"
        },
        {
          audio: "src/assets/sound/q4.wav",
          title: "Conversation 4",
          question: "100. What time is the train departing?",
          options: [
            "A) 2:15 p.m.",
            "B) 2:30 p.m.",
            "C) 3:00 p.m.",
            "D) 1:45 p.m."
          ],
          correctAnswer: "a"
        }

      ];

      // Audio playback tracking
      const playedAudios = new Set();

      // Timer
      let timeLeft = 45 * 60; // 30 minutes in seconds
      const timerDisplay = document.getElementById("timer");

      function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.innerHTML = `<i class="fas fa-clock me-2"></i> Time Remaining: ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          alert("Time's up!");
          submitQuiz();
        }
        timeLeft--;
      }

      // Check if coming from another page
      window.addEventListener("beforeunload", function() {
        localStorage.setItem("listeningTimeLeft", timeLeft);
        // Also store which audios have been played
        localStorage.setItem("playedAudios", JSON.stringify(Array.from(playedAudios)));
      });

      const timerInterval = setInterval(updateTimer, 1000);

      // Enhanced Audio management
      let currentAudioGroup = "";
      const mainAudio = document.getElementById("mainAudio");
      const playBtn = document.getElementById("playBtn");
      const playIcon = document.getElementById("playIcon");
      const progressBar = document.getElementById("progressBar");
      const currentTime = document.getElementById("currentTime");
      const durationTime = document.getElementById("durationTime");
      const audioStatus = document.getElementById("audioStatus");
      const audioTitle = document.getElementById("currentAudioTitle");

      // Load played audios from localStorage if available
      try {
        const storedPlayedAudios = JSON.parse(localStorage.getItem("playedAudios"));
        if (Array.isArray(storedPlayedAudios)) {
          storedPlayedAudios.forEach(audio => playedAudios.add(audio));
        }
      } catch (e) {
        console.error("Error loading played audios:", e);
      }

      // Format time from seconds to MM:SS
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        seconds = Math.floor(seconds % 60);
        return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
      }

      // Audio event listeners
      mainAudio.addEventListener('timeupdate', () => {
        const duration = mainAudio.duration;
        const currentTimeValue = mainAudio.currentTime;
        const percentage = (currentTimeValue / duration) * 100;
        
        progressBar.style.width = `${percentage}%`;
        currentTime.textContent = formatTime(currentTimeValue);
        
        // Update status text based on progress
        if (percentage > 0 && percentage < 100) {
          audioStatus.textContent = "Playing...";
        }
      });

      mainAudio.addEventListener('loadedmetadata', () => {
        durationTime.textContent = formatTime(mainAudio.duration);
        audioStatus.textContent = "Ready to play";
      });

      mainAudio.addEventListener('ended', () => {
        playIcon.classList.remove('fa-pause');
        playIcon.classList.add('fa-play');
        progressBar.style.width = '100%';
        audioStatus.textContent = "Playback complete";
        
        // Mark this audio as played and disable the button
        playedAudios.add(currentAudioGroup);
        playBtn.disabled = true;
        playBtn.classList.add('audio-played');
      });

      playBtn.addEventListener('click', () => {
        // If the audio has already been played, don't allow playback
        if (playedAudios.has(currentAudioGroup)) {
          audioStatus.textContent = "Already played (limited to once)";
          return;
        }
        
        if (mainAudio.paused) {
          mainAudio.play();
          playIcon.classList.remove('fa-play');
          playIcon.classList.add('fa-pause');
          audioStatus.textContent = "Playing...";
        } else {
          mainAudio.pause();
          playIcon.classList.remove('fa-pause');
          playIcon.classList.add('fa-play');
          audioStatus.textContent = "Paused";
        }
      });

      function updateAudioSource(audioFile, title) {
        if (currentAudioGroup !== audioFile) {
          mainAudio.src = audioFile;
          mainAudio.load();
          audioTitle.textContent = title;
          currentAudioGroup = audioFile;
          
          // Reset progress bar and status
          progressBar.style.width = '0%';
          currentTime.textContent = '0:00';
          durationTime.textContent = '0:00';
          
          // Check if this audio has already been played
          if (playedAudios.has(audioFile)) {
            playBtn.disabled = true;
            playBtn.classList.add('audio-played');
            audioStatus.textContent = "Already played (limited to once)";
          } else {
            playBtn.disabled = false;
            playBtn.classList.remove('audio-played');
            playIcon.classList.remove('fa-pause');
            playIcon.classList.add('fa-play');
            audioStatus.textContent = "Ready to play";
          }
        }
      }

      // Fungsi untuk membuat elemen pertanyaan
      function createQuestionElements() {
        const quizForm = document.getElementById("listening-quiz");
        const navigationButtons = quizForm.querySelector(".navigation-buttons");

        // Hapus semua pertanyaan yang ada (jika ada)
        const existingQuestions = quizForm.querySelectorAll(
          ".question-container"
        );
        existingQuestions.forEach((q) => q.remove());

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const pageNum = Math.ceil(questionNum / questionsPerPage);

          const questionContainer = document.createElement("div");
          questionContainer.className = "question-container";
          questionContainer.dataset.page = pageNum;
          questionContainer.dataset.question = questionNum;
          questionContainer.dataset.audio = q.audio;
          questionContainer.dataset.title = q.title;
          questionContainer.style.display = "none";

          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          questionDiv.innerHTML = `<i class="fas fa-question-circle me-2"></i> ${q.question}`;

          const optionsDiv = document.createElement("div");
          optionsDiv.className = "options";

          q.options.forEach((option, optIndex) => {
            const label = document.createElement("label");
            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${questionNum}`;
            input.value = String.fromCharCode(97 + optIndex); // a, b, c, d

            label.appendChild(input);
            label.appendChild(document.createTextNode(` ${option}`));
            optionsDiv.appendChild(label);
          });

          questionContainer.appendChild(questionDiv);
          questionContainer.appendChild(optionsDiv);
          quizForm.insertBefore(questionContainer, navigationButtons);
        });

        // Tampilkan halaman pertama
        showPage(1);
      }

      // Initialize question numbers
      const questionNumbersContainer =
        document.getElementById("questionNumbers");
      const totalQuestions = questions.length;

      function initializeQuestionNumbers() {
        questionNumbersContainer.innerHTML = "";

        for (let i = 1; i <= totalQuestions; i++) {
          const numberBtn = document.createElement("div");
          numberBtn.className = "question-number";
          numberBtn.textContent = i;
          numberBtn.dataset.question = i;
          numberBtn.addEventListener("click", () => {
            const pageNum = Math.ceil(i / questionsPerPage);
            showPage(pageNum);
            // Scroll to the specific question
            const questionElement = document.querySelector(
              `.question-container[data-question="${i}"]`
            );
            if (questionElement) {
              questionElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
              
              // Update audio source if needed
              updateAudioSource(
                questionElement.dataset.audio,
                questionElement.dataset.title
              );
            }
          });
          questionNumbersContainer.appendChild(numberBtn);
        }
      }

      // Track answered questions
      const answeredQuestions = new Set();

      // Add event listeners to all radio buttons
      function setupRadioButtonListeners() {
        document.querySelectorAll('input[type="radio"]').forEach((radio) => {
          radio.addEventListener("change", function () {
            const questionNum = this.name.substring(1);
            answeredQuestions.add(parseInt(questionNum));
            updateQuestionNumbers();

            // Simpan jawaban ke localStorage
            const userAnswers =
              JSON.parse(localStorage.getItem("listeningAnswers")) || {};
            userAnswers[`q${questionNum}`] = this.value;
            localStorage.setItem("listeningAnswers", JSON.stringify(userAnswers));
          });
        });
      }

      function updateQuestionNumbers() {
        document.querySelectorAll(".question-number").forEach((el) => {
          const questionNum = parseInt(el.dataset.question);
          el.classList.toggle("answered", answeredQuestions.has(questionNum));
          // Highlight current page questions
          const currentPageQuestions = Array.from(
            { length: questionsPerPage },
            (_, i) => (currentPage - 1) * questionsPerPage + i + 1
          );
          el.classList.toggle(
            "current",
            currentPageQuestions.includes(questionNum)
          );
        });
      }

      // Pagination logic
      let currentPage = 1;
      const totalPages = Math.ceil(totalQuestions / questionsPerPage);

      function showPage(pageNumber) {
        currentPage = pageNumber;
        const allQuestions = document.querySelectorAll(".question-container");
        allQuestions.forEach((q) => (q.style.display = "none"));

        // Show all questions for current page
        const pageQuestions = document.querySelectorAll(
          `.question-container[data-page="${pageNumber}"]`
        );
        pageQuestions.forEach((q) => (q.style.display = "block"));
        
        // Update audio source based on first question of the page
        if (pageQuestions.length > 0) {
          const firstQuestion = pageQuestions[0];
          updateAudioSource(
            firstQuestion.dataset.audio,
            firstQuestion.dataset.title
          );
        }

        updateQuestionNumbers();
        updateNavigationButtons();

        // Scroll to top of questions
        const firstQuestion = document.querySelector(
          `.question-container[data-page="${pageNumber}"][data-question="${
            (pageNumber - 1) * questionsPerPage + 1
          }"]`
        );
        if (firstQuestion) {
          firstQuestion.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const submitPageBtn = document.getElementById("submitPageBtn");

        // Update Previous button
        prevBtn.disabled = currentPage === 1;

        // Update Next/Submit buttons
        if (currentPage === totalPages) {
          nextBtn.style.display = "none";
          submitPageBtn.style.display = "inline-block";
        } else {
          nextBtn.style.display = "inline-block";
          submitPageBtn.style.display = "none";
        }
      }

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
          showPage(currentPage - 1);
        }
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentPage < totalPages) {
          showPage(currentPage + 1);
        }
      });

      document.getElementById("submitPageBtn").addEventListener("click", () => {
        document.getElementById("confirmModal").style.display = "flex";
      });

      // Initialize
      createQuestionElements();
      initializeQuestionNumbers();
      setupRadioButtonListeners();
      updateNavigationButtons();

      // Modal Confirmation
      document
        .getElementById("submitBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("confirmModal").style.display = "flex";
        });

      document
        .getElementById("confirmYes")
        .addEventListener("click", function () {
          submitQuiz();
        });

      document
        .getElementById("confirmNo")
        .addEventListener("click", function () {
          document.getElementById("confirmModal").style.display = "none";
        });

      // Submit Logic
      function submitQuiz() {
        document.getElementById("confirmModal").style.display = "none";
        clearInterval(timerInterval);

        let score = 0;
        const feedback = [];
        const questionDetails = {};
        const userAnswers = {};
        const categories = {
          conversation: { correct: 0, total: 6 },
          lecture: { correct: 0, total: 4 }
        };

        // Definisi kategori soal
        const questionCategories = {
          q1: "conversation",
          q2: "conversation",
          q3: "conversation",
          q4: "lecture",
          q5: "lecture",
          q6: "lecture",
          q7: "conversation",
          q8: "conversation",
          q9: "conversation",
          q10: "lecture"
        };

        questions.forEach((q, index) => {
          const questionNum = index + 1;
          const questionKey = `q${questionNum}`;
          const selected = document.querySelector(
            `input[name="q${questionNum}"]:checked`
          );
          const userAnswer = selected ? selected.value : null;

          userAnswers[questionKey] = userAnswer;
          const isCorrect = selected && selected.value === q.correctAnswer;

          if (isCorrect) {
            score++;
            feedback.push({ question: questionNum, result: "âœ“" });
          } else {
            feedback.push({
              question: questionNum,
              result: "âœ—",
              correct: q.correctAnswer.toUpperCase(),
            });
          }

          // Update kategori
          const category = questionCategories[questionKey];
          if (category) {
            if (isCorrect) categories[category].correct += 1;
          }

          questionDetails[questionKey] = {
            yourAnswer: userAnswer ? userAnswer.toUpperCase() : "-",
            correctAnswer: q.correctAnswer.toUpperCase(),
            result: isCorrect ? "âœ“" : "âœ—",
          };
        });

        localStorage.setItem("listeningScore", score);
        localStorage.setItem("listeningTotalQuestions", questions.length);
        localStorage.setItem("listeningAnswers", JSON.stringify(userAnswers));
        localStorage.setItem(
          "listeningQuestionDetails",
          JSON.stringify(questionDetails)
        );
        localStorage.setItem("listeningCategories", JSON.stringify(categories));
        
        // Save that listening test is complete
        localStorage.setItem("listeningComplete", "true");
        
        // Redirect to reading.html
        window.location.href = "reading.html";
      }

      document
        .getElementById("listening-quiz")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          submitQuiz();
        });

      // Disable right-click
      document.addEventListener("contextmenu", (e) => {
        e.preventDefault();
      });
    </script>
  </body>
</html>