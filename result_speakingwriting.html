<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hasil TOEIC Speaking & Writing</title>
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --orange-primary: #f57f20;
        --orange-dark: #d16a1a;
        --orange-light: #fff5ee;
        --dark-text: #2a2a2a;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--orange-light);
        color: var(--dark-text);
      }
      header {
        background: linear-gradient(
          135deg,
          var(--orange-primary),
          var(--orange-dark)
        );
        color: white;
        padding: 60px 0 50px;
        position: relative;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        overflow: hidden;
      }
      .score-box {
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        padding: 20px;
        border-radius: 12px;
        background-color: var(--orange-light);
        color: var(--orange-dark);
      }
      .btn-print {
        background: var(--orange-dark);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 500;
      }
      .btn-print:hover {
        background: var(--orange-primary);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ddd;
        vertical-align: top;
      }
      th {
        background-color: var(--orange-light);
        color: var(--orange-dark);
      }
      tr.completed td {
        background-color: #e8f5e9;
      }
      tr.not-completed td {
        background-color: #ffebee;
      }
      footer {
        background: linear-gradient(135deg, var(--orange-dark), #b85c18);
        color: white;
        padding: 25px 0;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="container-fluid text-center py-4">
      <div class="container">
        <h1 class="mb-3">Hasil Ujian TOEIC</h1>
        <p class="lead">Speaking & Writing Practice Test</p>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="glass-card p-4">
            <h3 class="text-center mb-4">
              <i class="fas fa-trophy me-2"></i> Skor Akhir
            </h3>

            <!-- Speaking Section -->
            <div class="mb-4">
              <h5 class="text-center mb-3">Speaking Section</h5>
              <div class="score-box" id="speakingScore">Skor: 0 / 50</div>
              <p class="text-center small text-muted">
                Soal terjawab: <strong id="completedTasks">0 / 11</strong>
              </p>
              <h6 class="mt-4">Detail Jawaban:</h6>
              <table>
                <thead>
                  <tr>
                    <th>Pertanyaan</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="speakingResultsTable"></tbody>
              </table>
            </div>

            <!-- Writing Section -->
            <div class="mb-4">
              <h5 class="text-center mb-3">Writing Section</h5>
              <div class="score-box" id="writingScore">Skor: 0 / 100</div>
              <p class="text-center small text-muted">
                Soal terjawab: <strong id="answeredQuestions">0 / 8</strong>
              </p>
              <h6 class="mt-4">Detail Jawaban:</h6>
              <table>
                <thead>
                  <tr>
                    <th>Pertanyaan</th>
                    <th>Jawaban</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="writingResultsTable"></tbody>
              </table>
            </div>

            <!-- Overall Score -->
            <div class="mt-4 text-center">
              <h4>
                Skor Keseluruhan:
                <span class="score-box d-inline-block px-3 py-2">0 / 150</span>
              </h4>
            </div>

            <!-- Tombol Print -->
            <div class="d-flex justify-content-center mt-4">
              <button class="btn btn-print" onclick="window.print()">
                <i class="fas fa-print me-2"></i> Cetak Hasil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="container-fluid py-3">
      <div class="container">
        <p class="small mb-0">Â© 2025 TOEIC Tester | Practice Language Skills</p>
      </div>
    </footer>

    <script>
      // Load data dari localStorage
      const completedTasks =
        JSON.parse(localStorage.getItem("completedTasks")) || [];
      const writingResponses =
        JSON.parse(localStorage.getItem("writingResponses")) || [];

      // Update skor
      document.getElementById(
        "completedTasks"
      ).textContent = `${completedTasks.length} / 11`;
      document.getElementById("answeredQuestions").textContent = `${
        writingResponses.filter((q) => q.response).length
      } / 8`;

      // Hitung skor
      const speakingScore = Math.round((completedTasks.length / 11) * 50);
      const writingScore = Math.round(
        (writingResponses.filter((q) => q.response).length / 8) * 100
      );

      document.getElementById(
        "speakingScore"
      ).textContent = `Skor: ${speakingScore} / 50`;
      document.getElementById(
        "writingScore"
      ).textContent = `Skor: ${writingScore} / 100`;

      document.querySelector(".score-box:last-child").textContent = `${
        speakingScore + writingScore
      } / 150`;

      // Data pertanyaan speaking
      const speakingPrompts = [
        "Welcome to our annual conference...",
        "Read passage about university renovations...",
        "Listen to part of an academic lecture...",
        "The students discuss two possible solutions...",
        "What is the most important quality a leader should have?",
        "Summarize the woman's opinion about the library...",
        "You need to give a speech at work tomorrow...",
        "Two people talk about working from home...",
        "What are the pros and cons of online education?",
        "Do you prefer working in teams or alone?",
        "Suggest a solution for your friend...",
      ];

      const speakingResultsTable = document.getElementById(
        "speakingResultsTable"
      );
      speakingPrompts.forEach((prompt, index) => {
        const taskId = index + 1;
        const isCompleted = completedTasks.includes(taskId);
        const row = document.createElement("tr");
        row.className = isCompleted ? "completed" : "not-completed";

        const promptCell = document.createElement("td");
        promptCell.textContent = prompt;

        const statusCell = document.createElement("td");
        statusCell.textContent = isCompleted ? "Selesai" : "Belum";

        const actionCell = document.createElement("td");
        if (isCompleted && window.audioBlobs && window.audioBlobs[taskId]) {
          const audioUrl = URL.createObjectURL(window.audioBlobs[taskId]);
          const playBtn = document.createElement("button");
          playBtn.innerHTML = '<i class="fas fa-play me-1"></i> Putar';
          playBtn.className = "btn btn-sm btn-outline-success";
          playBtn.onclick = () => {
            const audio = new Audio(audioUrl);
            audio.play();
          };
          actionCell.appendChild(playBtn);
        } else {
          actionCell.textContent = "Tidak ada rekaman";
        }

        row.appendChild(promptCell);
        row.appendChild(statusCell);
        row.appendChild(actionCell);
        speakingResultsTable.appendChild(row);
      });

      // Data pertanyaan writing
      const writingQuestions = [
        "Write a sentence based on the picture below using the two words provided.",
        "Write a sentence based on the picture below using the two words provided.",
        "Write a sentence based on the picture below using the two words provided.",
        "Write a sentence based on the picture below using the two words provided.",
        "Write a sentence based on the picture below using the two words provided.",
        "Respond to the email below. Describe ONE issue...",
        "Respond to the email below. Describe ONE problem...",
        "Some individuals claim that technology leads to increased isolation...",
      ];

      const writingResultsTable = document.getElementById(
        "writingResultsTable"
      );
      writingQuestions.forEach((question, index) => {
        const isAnswered = writingResponses[index]?.response?.trim() !== "";
        const row = document.createElement("tr");
        row.className = isAnswered ? "completed" : "not-completed";

        const questionCell = document.createElement("td");
        questionCell.textContent = question;

        const answerCell = document.createElement("td");
        answerCell.textContent =
          writingResponses[index]?.response?.trim() || "Belum dijawab";

        const statusCell = document.createElement("td");
        statusCell.textContent = isAnswered ? "Jawab" : "Belum";

        row.appendChild(questionCell);
        row.appendChild(answerCell);
        row.appendChild(statusCell);
        writingResultsTable.appendChild(row);
      });
    </script>
  </body>
</html>
